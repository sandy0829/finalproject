---
title: "?°?£??„åœ°??€?™»?©?†±??†æ??"
output: github_document
---

##Åª¤J¸ê®Æ
```{r}
#³o¬OR Code Chunk
library(readr)
#99~106¦~°ª¶¯µn­²¼ö¸ê®Æ
MosIndex_Kaohsiung <- read_csv("C:/Users/user/Downloads/MosIndex_Kaohsiung.csv")
#104¦~°ª¶¯¦U¦a°Ï¦U¤ë¥÷¯f¨Ò¸ê®Æ
X104dengueinfection <- read_csv("C:/Users/user/Downloads/104dengueinfection.csv")
#¥x«n¥«¡B°ª¶¯¥«¡B«ÌªF¿¤§Ö¿z¶E©Ò¸ê®Æ
ns1hosp_20160603 <- read_csv("C:/Users/user/Downloads/ns1hosp_20160603.csv")
#99~106¦~¥ş¥xµn­²¼ö¸ê®Æ
MosIndex_All <- read_csv("C:/Users/user/Downloads/MosIndex_All.csv")
#104¦~¥ş¥x¦U¶mÂí¥«°Ï¤H¤f±K«×
opendata104N010 <- read_csv("C:/Users/user/Downloads/opendata104N010.csv")
```
##¸ê®Æ³B²z»P²M¬~¡B¸ê®ÆµøÄ±¤Æ(99~106¦~¥ş¥xµn­²¼ö¸ê®Æ)
```{r}
#³o¬OR Code Chunk
library(dplyr)
MosIndex_Allc<-select(MosIndex_All,Date:AreaType)
MosIndex_Allc<-MosIndex_Allc[complete.cases(MosIndex_Allc),]
MosIndex_Allc$VillageLon<-as.numeric(MosIndex_Allc$VillageLon)
MosIndex_Allc$VillageLat<-as.numeric(MosIndex_Allc$VillageLat)
MosIndex_Allc2010<-MosIndex_Allc[grepl("2010",MosIndex_Allc$Date),]
MosIndex_Allc2011<-MosIndex_Allc[grepl("2011",MosIndex_Allc$Date),]
MosIndex_Allc2012<-MosIndex_Allc[grepl("2012",MosIndex_Allc$Date),]
MosIndex_Allc2013<-MosIndex_Allc[grepl("2013",MosIndex_Allc$Date),]
MosIndex_Allc2014<-MosIndex_Allc[grepl("2014",MosIndex_Allc$Date),]
MosIndex_Allc2015<-MosIndex_Allc[grepl("2015",MosIndex_Allc$Date),]
MosIndex_Allc2016<-MosIndex_Allc[grepl("2016",MosIndex_Allc$Date),]
MosIndex_Allc2017<-MosIndex_Allc[grepl("2017",MosIndex_Allc$Date),]
library(ggmap)
Taiwanmap <- get_map(location = "Taiwan", zoom = 8)
densityMap0<-ggmap(Taiwanmap,extent = "device")+ 
  geom_density2d(data = MosIndex_Allc2010, aes(x = VillageLon, y = VillageLat), size = 0.3)+
  stat_density2d(data = MosIndex_Allc2010, 
                 aes(x = VillageLon, y = VillageLat, 
                     fill = ..level.., alpha = ..level..), 
                 size = 0.01, bins = 16, geom = "polygon") + 
  scale_fill_gradient(low = "green", 
                      high = "red", guide = FALSE) + 
  scale_alpha(range = c(0, 0.3), guide = FALSE)
densityMap0
Taiwanmap <- get_map(location = "Taiwan", zoom = 8)
densityMap1<-ggmap(Taiwanmap,extent = "device")+ 
  geom_density2d(data = MosIndex_Allc2011, aes(x = VillageLon, y = VillageLat), size = 0.3)+
  stat_density2d(data = MosIndex_Allc2011, 
                 aes(x = VillageLon, y = VillageLat, 
                     fill = ..level.., alpha = ..level..), 
                 size = 0.01, bins = 16, geom = "polygon") + 
  scale_fill_gradient(low = "green", 
                      high = "red", guide = FALSE) + 
  scale_alpha(range = c(0, 0.3), guide = FALSE)
densityMap1
Taiwanmap <- get_map(location = "Taiwan", zoom = 8)
densityMap2<-ggmap(Taiwanmap,extent = "device")+ 
  geom_density2d(data = MosIndex_Allc2012, aes(x = VillageLon, y = VillageLat), size = 0.3)+
  stat_density2d(data = MosIndex_Allc2012, 
                 aes(x = VillageLon, y = VillageLat, 
                     fill = ..level.., alpha = ..level..), 
                 size = 0.01, bins = 16, geom = "polygon") + 
  scale_fill_gradient(low = "green", 
                      high = "red", guide = FALSE) + 
  scale_alpha(range = c(0, 0.3), guide = FALSE)
densityMap2
Taiwanmap <- get_map(location = "Taiwan", zoom = 8)
densityMap3<-ggmap(Taiwanmap,extent = "device")+ 
  geom_density2d(data = MosIndex_Allc2013, aes(x = VillageLon, y = VillageLat), size = 0.3)+
  stat_density2d(data = MosIndex_Allc2013, 
                 aes(x = VillageLon, y = VillageLat, 
                     fill = ..level.., alpha = ..level..), 
                 size = 0.01, bins = 16, geom = "polygon") + 
  scale_fill_gradient(low = "green", 
                      high = "red", guide = FALSE) + 
  scale_alpha(range = c(0, 0.3), guide = FALSE)
densityMap3
densityMap4<-ggmap(Taiwanmap,extent = "device")+ 
  geom_density2d(data = MosIndex_Allc2014, aes(x = VillageLon, y = VillageLat), size = 0.3)+
  stat_density2d(data = MosIndex_Allc2014, 
                 aes(x = VillageLon, y = VillageLat, 
                     fill = ..level.., alpha = ..level..), 
                 size = 0.01, bins = 16, geom = "polygon") + 
  scale_fill_gradient(low = "green", 
                      high = "red", guide = FALSE) + 
  scale_alpha(range = c(0, 0.3), guide = FALSE)
densityMap4
Taiwanmap <- get_map(location = "Taiwan", zoom = 8)
densityMap5<-ggmap(Taiwanmap,extent = "device")+ 
  geom_density2d(data = MosIndex_Allc2015, aes(x = VillageLon, y = VillageLat), size = 0.3)+
  stat_density2d(data = MosIndex_Allc2015, 
                 aes(x = VillageLon, y = VillageLat, 
                     fill = ..level.., alpha = ..level..), 
                 size = 0.01, bins = 16, geom = "polygon") + 
  scale_fill_gradient(low = "green", 
                      high = "red", guide = FALSE) + 
  scale_alpha(range = c(0, 0.3), guide = FALSE)
densityMap5
Taiwanmap <- get_map(location = "Taiwan", zoom = 8)
densityMap6<-ggmap(Taiwanmap,extent = "device")+ 
  geom_density2d(data = MosIndex_Allc2016, aes(x = VillageLon, y = VillageLat), size = 0.3)+
  stat_density2d(data = MosIndex_Allc2016, 
                 aes(x = VillageLon, y = VillageLat, 
                     fill = ..level.., alpha = ..level..), 
                 size = 0.01, bins = 16, geom = "polygon") + 
  scale_fill_gradient(low = "green", 
                      high = "red", guide = FALSE) + 
  scale_alpha(range = c(0, 0.3), guide = FALSE)
densityMap6
Taiwanmap <- get_map(location = "Taiwan", zoom = 8)
densityMap7<-ggmap(Taiwanmap,extent = "device")+ 
  geom_density2d(data = MosIndex_Allc2017, aes(x = VillageLon, y = VillageLat), size = 0.3)+
  stat_density2d(data = MosIndex_Allc2017, 
                 aes(x = VillageLon, y = VillageLat, 
                     fill = ..level.., alpha = ..level..), 
                 size = 0.01, bins = 16, geom = "polygon") + 
  scale_fill_gradient(low = "green", 
                      high = "red", guide = FALSE) + 
  scale_alpha(range = c(0, 0.3), guide = FALSE)
densityMap7
```

##¸ê®Æ³B²z»P²M¬~¡B¸ê®ÆµøÄ±¤Æ(99~106¦~°ª¶¯µn­²¼ö¸ê®Æ)
```{r}
library(dplyr)
MosIndex_Kaohsiungc<-select(MosIndex_Kaohsiung,Date:AreaType)
MosIndex_Kaohsiungc2015<-MosIndex_Kaohsiungc[grepl("2015",MosIndex_Kaohsiungc$Date),]
MosIndex_Kaohsiungc2016<-MosIndex_Kaohsiungc[grepl("2016",MosIndex_Kaohsiungc$Date),]
library(ggmap)
khcmap <- get_map(location ='Kaohsiung', 
                 zoom = 10,
                 language = "zh-TW", maptype = 'roadmap')
khcmap1 <- ggmap(khcmap)+ 
  geom_point(data=MosIndex_Kaohsiungc, 
             aes(x=VillageLon, y=VillageLat),colour="red")
khcmap1
```
##¸ê®Æ³B²z»P²M¬~¡B¸ê®ÆµøÄ±¤Æ(104¦~°ª¶¯¦U¦a°Ï¦U¤ë¥÷¯f¨Ò¸ê®Æ)
```{r}
X104dengueinfectionC<-select(X104dengueinfection,¦æ¬F°Ï:`12¤ë`)
library(reshape2)
X104dengueinfectionM<-melt(X104dengueinfectionC,id.vars = "¦æ¬F°Ï")
X104dengueinfectionM1<-X104dengueinfectionM[grepl("°Ï",X104dengueinfectionM$¦æ¬F°Ï),]
#104¦~¦U¤ë¥÷°ª¶¯¦a°Ïªº¯f¨Ò¼Æ
test<-group_by(X104dengueinfectionM1,variable) %>%
  summarise(¦¸¼Æ=sum(value,na.rm=T))%>%
  arrange(desc(¦¸¼Æ))
test
ggplot()+geom_bar(data=test,aes(x= variable,y= ¦¸¼Æ),
                  stat = "identity")+xlab("¤ë¥÷")
#104¦~°ª¶¯¦U¦a°ÏªºÁ`¯f¨Ò
test1<-group_by(X104dengueinfectionM1,.dots=¦æ¬F°Ï) %>%
 summarise(¯f¨Ò=sum(value,na.rm=T)) %>%
    arrange(desc(¯f¨Ò))
test1<-rename(test1,site_id=.dots)
test1
```
##¸ê®Æ³B²z»P²M¬~¡B¸ê®ÆµøÄ±¤Æ(¥x«n¥«¡B°ª¶¯¥«¡B«ÌªF¿¤§Ö¿z¶E©Ò¸ê®Æ)
```{r}
ns1hosp_20160603K<- ns1hosp_20160603[grep("°ª¶¯¥«",ns1hosp_20160603$city),]
#µn­²¼ö§Ö¿z©Ò»P¯f¨Ò¤À¥¬
library(ggmap)
Kaohsiungmap <- get_map(location = "Kaohsiung", zoom = 10,
                        language = "zh-TW", maptype = "roadmap")
#¬õ¦â¬O¯f¨Ò¡Aºñ¦â¬O§Ö¿z©Ò
Kaohsiungmap0 <- ggmap(Kaohsiungmap)+ 
  geom_point(data=MosIndex_Kaohsiungc2015, 
             aes(x = VillageLon, y = VillageLat),
             colour="red",size=1.2)+
  geom_point(data=ns1hosp_20160603K, 
             aes(x = lng, y = lat),
             colour="green",size=1.2)
Kaohsiungmap0
```
##¸ê®Æ³B²z»P²M¬~¡B¸ê®ÆµøÄ±¤Æ(104¦~¥ş¥x¦U¶mÂí¥«°Ï¤H¤f±K«×)
```{r}
opendata104N010C<-opendata104N010[grepl("°ª¶¯¥«",opendata104N010$site_id),]
opendata104N010C<-opendata104N010C[complete.cases(opendata104N010C$statistic_yyy),]
opendata104N010C$site_id<-substr(opendata104N010C$site_id,start = 4,stop = 7)
a<-full_join(opendata104N010C,test1,by="site_id")
a<-mutate(a,²±¦æ²v=¯f¨Ò/as.numeric(people_total))
```